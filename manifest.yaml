version: "2"
name: "Airmeet Integration"
description: "Syncs attendee data between Airmeet and DevRev"

service_account:
  display_name: Airmeet Sync Bot

inputs:
  organization:
    - name: airmeet_region
      description: Airmeet API Region (default, eu, us)
      field_type: text
      default_value: "default"
      ui:
        display_name: Airmeet Region
    - name: account_linking_enabled
      description: Enable account linking and creation
      field_type: bool
      default_value: true
      ui:
        display_name: Enable Account Linking
    - name: custom_object_name
      description: Name of the custom object to map events to
      field_type: text
      default_value: "airmeet_event"
      ui:
        display_name: Custom Object Name

event_sources:
  organization:
    - name: airmeet-webhooks
      description: Airmeet webhook events listener
      display_name: Airmeet Events
      type: flow-custom-webhook
      config:
        policy: |
          package rego
          output = {"event": event, "event_key": event_key} {
            event := input.request.body
            event_key := "airmeet.registration"
          } else = {"response": response} {
            response := {
              "status_code": 400,
              "body": "Invalid request format"
            }
          }

# Functions reference: https://docs.devrev.ai/snap-ins/references/functions.
functions:
  - name: handle_registration
    description: Handle attendee registration events
  - name: handle_attendance
    description: Handle attendee join events and track time spent
  - name: handle_booth_activity
    description: Handle booth visits and lead magnet interactions
  - name: handle_engagement
    description: Handle attendee questions and interactions

# Automations reference: https://docs.devrev.ai/snap-ins/concepts#automation.
automations:
  - name: process-registration
    source: airmeet-webhooks
    event_types:
      - attendee.registered
    function: handle_registration
  
  - name: track-attendance
    source: airmeet-webhooks
    event_types:
      - attendee.joined
    function: handle_attendance
  
  - name: track-booth-activity
    source: airmeet-webhooks
    event_types:
      - attendee.booth_visit
    function: handle_booth_activity
  
  - name: track-engagement
    source: airmeet-webhooks
    event_types:
      - attendee.question_asked
    function: handle_engagement
