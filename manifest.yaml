version: "2"
name: "Airmeet Integration"
description: "Syncs attendee data between Airmeet and DevRev"

service_account:
  display_name: Airmeet Sync Bot

event_sources:
  organization:
    - name: airmeet-webhooks
      type: flow-custom-webhook
      display_name: Airmeet Events
      setup_instructions: |
        ## Please copy the source URL from here:
        URL: `{{source.trigger_url}}`
      config:
        policy: |
          package rego
          output = {"event": event, "event_key": event_key} {
            event := input.request.body
            event_key := "airmeet_registration"
          }

inputs:
  organization:
    - name: create_contact_account
      description: Enable this option to create and link accounts and contacts for registrations. If disabled, accounts and contacts won't be created.
      field_type: bool
      is_required: true
      default_value: true
      ui:
        display_name: Create Account and Contact
    - name: leaf_type
      description: Leaf type for Airmeet registration custom objects
      field_type: text
      default_value: 'airmeet_registration'
      ui:
        display_name: Custom Object Type
      is_required: true
    - name: custom_fields_mapping
      description: Mapping from Airmeet registration fields to custom object fields
      field_type: text
      default_value: '{ "name": "tnt__attendee_name", "email": "tnt__attendee_email", "event_id": "tnt__event_id" }'
      ui:
        display_name: Registration to Custom Object Mapping
      is_required: true
    - name: account_mapping
      description: Mapping from Airmeet fields to account fields
      field_type: text
      default_value: '{ "company": "display_name" }'
      ui:
        display_name: Registration to Account Mapping
      is_required: false
    - name: contact_mapping
      description: Mapping from Airmeet fields to contact fields
      field_type: text
      default_value: '{ "name": "display_name", "email": "email" }'
      ui:
        display_name: Registration to Contact Mapping
      is_required: false

functions:
  - name: handle_registration
    description: Creates custom objects, accounts, and contacts from Airmeet registrations

automations:
  - name: process_registration
    source: airmeet-webhooks
    event_types:
      - custom:airmeet_registration
    function: handle_registration

# Functions reference: https://docs.devrev.ai/snap-ins/references/functions.
functions:
  - name: handle_registration
    description: Handle attendee registration events
  - name: handle_attendance
    description: Handle attendee join events and track time spent
  - name: handle_booth_activity
    description: Handle booth visits and lead magnet interactions
  - name: handle_engagement
    description: Handle attendee questions and interactions

# Automations reference: https://docs.devrev.ai/snap-ins/concepts#automation.
automations:
  - name: process-registration
    source: airmeet-webhooks
    event_types:
      - attendee.registered
    function: handle_registration
  
  - name: track-attendance
    source: airmeet-webhooks
    event_types:
      - attendee.joined
    function: handle_attendance
  
  - name: track-booth-activity
    source: airmeet-webhooks
    event_types:
      - attendee.booth_visit
    function: handle_booth_activity
  
  - name: track-engagement
    source: airmeet-webhooks
    event_types:
      - attendee.question_asked
    function: handle_engagement
